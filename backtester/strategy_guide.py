"""
File: backtester/strategy_guide.py
Strategy Selection Guide and Performance Benchmarks
"""

def show_strategy_guide():
    """전략 가이드 표시"""
    print("""
📚 퀀트 전략 가이드

🏛️ 전설적 투자자 전략들 (1-7):
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. Basic Momentum (모멘텀)
   📈 상승 추세를 따라가는 전략
   🎯 초보자에게 추천, 트렌드 시장에서 효과적
   ⚠️ 횡보장에서는 손실 위험

2. Basic Mean Reversion (평균회귀)
   📊 가격이 평균으로 돌아간다는 원리
   🎯 횡보장에서 효과적
   ⚠️ 강한 트렌드에서는 손실 위험

3. Warren Buffett Value (가치투자)
   🏛️ 저평가된 우량 기업을 장기 보유
   🎯 안정성을 추구하는 투자자에게 적합
   ⚠️ 단기 수익률은 낮을 수 있음

4. Benjamin Graham Deep Value (딥밸류)
   📚 극도로 저평가된 종목 발굴
   🎯 보수적 투자자에게 적합
   ⚠️ 장기간 보유 필요

5. Peter Lynch Growth (성장주)
   🚀 성장 잠재력이 큰 기업에 투자
   🎯 중장기 고수익을 원하는 투자자
   ⚠️ 변동성이 큰 편

6. Ray Dalio All Weather (전천후)
   🌤️ 모든 경제 환경에서 안정적 수익
   🎯 꾸준한 수익을 원하는 투자자
   ⚠️ 폭발적 수익률 기대 어려움

7. George Soros Reflexivity (재귀성)
   ⚡ 시장 심리와 트렌드를 이용
   🎯 단기 고수익 추구자
   ⚠️ 높은 위험도

🔬 고급 퀀트 전략들 (8-20):
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

8. Pairs Trading (페어 트레이딩)
   🔄 상관관계 높은 자산간 차익거래
   🎯 시장 중립적, 저위험 추구자
   ⚠️ 복잡한 전략, 고급 투자자용

9. Factor Model (팩터 모델)
   📊 여러 요인을 종합 고려
   🎯 체계적 투자를 원하는 투자자
   ⚠️ 학술적 배경 지식 필요

10. Volatility Targeting (변동성 타겟팅)
    🎯 일정한 리스크 수준 유지
    🎯 리스크 관리 중시 투자자
    ⚠️ 복잡한 포지션 관리

11-20. 기타 고급 전략들
    • Calendar Anomaly (달력 이상현상)
    • Breakout Strategy (돌파 전략)
    • Machine Learning (머신러닝)
    • Statistical Arbitrage (통계적 차익거래)
    • Event Driven (이벤트 드리븐)
    • Quant Momentum (퀀트 모멘텀)
    • Carry Trade (캐리 트레이드)
    • Risk Parity (리스크 패리티)
    • Contrarian (역발상)
    • Custom Portfolio (커스텀 포트폴리오)

💡 전략 선택 가이드:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🎯 투자 성향별 추천:
   • 초보자: 1, 2 (Basic Momentum, Mean Reversion)
   • 안정형: 3, 4, 6, 17, 18 (가치투자, 전천후, 캐리, 리스크패리티)
   • 공격형: 5, 7, 15, 16 (성장주, 소로스, 이벤트, 퀀트모멘텀)
   • 전문가: 8, 9, 13, 14 (페어, 팩터, ML, 통계적차익거래)

🎯 시장 상황별 추천:
   • 상승장: 1, 5, 16 (모멘텀 계열)
   • 하락장: 19, 4 (역발상, 딥밸류)
   • 횡보장: 2, 8, 14 (평균회귀, 중립 전략)
   • 불안정: 6, 10, 18 (안정성 중시)

🎯 복합 전략: 20 (Custom Portfolio) - 여러 전략 조합으로 리스크 분산
    """)

def performance_benchmark():
    """성과 벤치마크 가이드"""
    print("""
📊 성과 지표 해석 가이드

🎯 주요 지표 설명:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📈 연간 수익률 (Annual Return)
   • 15% 이상: 매우 우수
   • 10-15%: 우수
   • 7-10%: 양호 (S&P 500 평균)
   • 5-7%: 보통
   • 5% 미만: 개선 필요

⚡ 샤프 비율 (Sharpe Ratio) - 위험 대비 수익
   • 2.0 이상: 매우 우수
   • 1.5-2.0: 우수
   • 1.0-1.5: 양호
   • 0.5-1.0: 보통
   • 0.5 미만: 개선 필요

📉 최대 낙폭 (Max Drawdown)
   • 5% 이하: 매우 안정적
   • 5-10%: 안정적
   • 10-20%: 양호
   • 20-30%: 보통
   • 30% 이상: 높은 위험

🎯 소르티노 비율 (Sortino Ratio) - 하방 위험 대비 수익
   • 2.0 이상: 매우 우수
   • 1.5-2.0: 우수
   • 1.0-1.5: 양호
   • 0.5-1.0: 보통
   • 0.5 미만: 개선 필요

💪 칼마 비율 (Calmar Ratio) - 연수익률/최대낙폭
   • 1.5 이상: 매우 우수
   • 1.0-1.5: 우수
   • 0.5-1.0: 양호
   • 0.3-0.5: 보통
   • 0.3 미만: 개선 필요

🏆 승률 (Win Rate)
   • 70% 이상: 매우 우수
   • 60-70%: 우수
   • 50-60%: 양호
   • 40-50%: 보통
   • 40% 미만: 개선 필요

🎯 종합 평가 기준:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🏆 S급 전략: 샤프 비율 1.5+, 최대 낙폭 10% 이하, 연수익률 12%+
🥇 A급 전략: 샤프 비율 1.0+, 최대 낙폭 15% 이하, 연수익률 10%+
🥈 B급 전략: 샤프 비율 0.7+, 최대 낙폭 20% 이하, 연수익률 8%+
🥉 C급 전략: 샤프 비율 0.5+, 최대 낙폭 25% 이하, 연수익률 6%+
🔴 D급 전략: 위 기준 미만 - 전략 개선 필요

📈 벤치마크 비교:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

• S&P 500 ETF (SPY): 연 10%, 샤프 0.7, 최대낙폭 20%
• 나스닥 ETF (QQQ): 연 12%, 샤프 0.8, 최대낙폭 25%
• 채권 ETF (AGG): 연 4%, 샤프 0.5, 최대낙폭 5%
• 금 ETF (GLD): 연 6%, 샤프 0.4, 최대낙폭 15%

💡 주의사항:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

• 과거 성과가 미래 성과를 보장하지 않습니다
• 여러 지표를 종합적으로 고려하세요
• 본인의 위험 성향에 맞는 전략을 선택하세요
• 백테스트는 실제 거래와 다를 수 있습니다
• 거래 비용과 세금이 실제 수익률에 영향을 줍니다
    """)

def calculate_strategy_grade(result):
    """전략 등급 계산"""
    annual_return = result['Annual_Return_%']
    sharpe = result['Sharpe_Ratio']
    max_dd = result['Max_Drawdown_%']
    
    # 점수 계산
    score = 0
    
    # 연수익률 점수 (0-40점)
    if annual_return >= 15:
        score += 40
    elif annual_return >= 12:
        score += 35
    elif annual_return >= 10:
        score += 30
    elif annual_return >= 8:
        score += 25
    elif annual_return >= 6:
        score += 20
    else:
        score += 10
    
    # 샤프 비율 점수 (0-40점)
    if sharpe >= 2.0:
        score += 40
    elif sharpe >= 1.5:
        score += 35
    elif sharpe >= 1.0:
        score += 30
    elif sharpe >= 0.7:
        score += 25
    elif sharpe >= 0.5:
        score += 20
    else:
        score += 10
    
    # 최대 낙폭 점수 (0-20점, 낮을수록 좋음)
    if max_dd <= 5:
        score += 20
    elif max_dd <= 10:
        score += 18
    elif max_dd <= 15:
        score += 15
    elif max_dd <= 20:
        score += 12
    elif max_dd <= 25:
        score += 8
    else:
        score += 5
    
    # 등급 결정
    if score >= 90:
        return "🏆 S급 (뛰어난 전략)"
    elif score >= 80:
        return "🥇 A급 (우수한 전략)"
    elif score >= 70:
        return "🥈 B급 (양호한 전략)"
    elif score >= 60:
        return "🥉 C급 (보통 전략)"
    else:
        return "🔴 D급 (개선 필요)"

def get_strategy_recommendations(risk_tolerance='medium', market_condition='normal', experience_level='intermediate'):
    """투자자 성향에 따른 전략 추천"""
    recommendations = {
        'conservative': {
            'low_risk': [3, 4, 6, 17, 18],  # 가치투자, 딥밸류, 전천후, 캐리, 리스크패리티
            'description': '안정성과 자본 보전을 최우선으로 하는 전략들'
        },
        'moderate': {
            'medium_risk': [1, 2, 9, 10, 20],  # 모멘텀, 평균회귀, 팩터, 변동성타겟, 커스텀
            'description': '적당한 위험으로 꾸준한 수익을 추구하는 전략들'
        },
        'aggressive': {
            'high_risk': [5, 7, 15, 16, 19],  # 성장주, 소로스, 이벤트, 퀀트모멘텀, 역발상
            'description': '높은 수익을 위해 높은 위험을 감수하는 전략들'
        },
        'professional': {
            'complex': [8, 13, 14],  # 페어트레이딩, ML, 통계적차익거래
            'description': '고급 수학적/통계적 기법을 활용하는 전문가용 전략들'
        }
    }
    
    return recommendations

def show_market_timing_guide():
    """시장 상황별 전략 가이드"""
    print("""
📅 시장 상황별 전략 선택 가이드

🌟 강세장 (Bull Market):
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📈 추천 전략: 1(모멘텀), 5(성장주), 16(퀀트모멘텀)
💡 특징: 상승 트렌드를 따라가는 전략이 효과적
⚠️ 주의: 과도한 레버리지나 집중 투자 피하기

🐻 약세장 (Bear Market):
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📉 추천 전략: 4(딥밸류), 19(역발상), 6(전천후)
💡 특징: 저평가 자산 발굴과 방어적 전략 중요
⚠️ 주의: 하락장에서도 무리한 저점 매수 금지

📊 횡보장 (Sideways Market):
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔄 추천 전략: 2(평균회귀), 8(페어트레이딩), 14(통계적차익거래)
💡 특징: 범위 내 변동을 활용하는 전략 선호
⚠️ 주의: 돌파 신호에 대한 준비 필요

🌪️ 고변동성 시장:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
⚡ 추천 전략: 10(변동성타겟팅), 15(이벤트드리븐), 18(리스크패리티)
💡 특징: 변동성 자체를 활용하거나 리스크 관리 중점
⚠️ 주의: 포지션 사이즈 조절과 손절 규칙 엄격히 적용

🔮 불확실성 시기:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🛡️ 추천 전략: 17(캐리트레이드), 20(커스텀포트폴리오), 3(가치투자)
💡 특징: 안정성과 분산투자를 통한 리스크 완화
⚠️ 주의: 과도한 리스크 회피로 기회 놓치지 않기
    """)

def show_risk_management_guide():
    """리스크 관리 가이드"""
    print("""
⚠️ 리스크 관리 가이드

💰 포지션 사이징:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
• 총 자산의 2-5%를 단일 전략에 배분
• 고위험 전략은 1-2%, 저위험 전략은 5-10%
• 상관관계가 높은 전략들의 총 비중 제한

🛑 손실 제한:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
• 개별 전략 최대 손실: 총 자산의 2%
• 월간 최대 손실: 총 자산의 5%
• 연간 최대 손실: 총 자산의 15%

📈 수익 실현:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
• 목표 수익률 달성시 부분 실현 (50-70%)
• 연속 수익시 포지션 크기 점진적 확대
• 최대 25% 이익시 전체 실현 고려

🔄 리밸런싱:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
• 월 1회 정기 리밸런싱
• 전략별 비중이 목표치에서 ±30% 벗어나면 조정
• 시장 급변동시 즉시 리밸런싱 검토

📊 모니터링 지표:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
• 일일: 총 자산 변화율, 개별 전략 성과
• 주간: 샤프 비율, 최대 낙폭 변화
• 월간: 전략별 기여도, 상관관계 변화
• 분기: 전략 교체/조정 검토
    """)

def get_beginner_recommendations():
    """초보자를 위한 전략 추천"""
    return {
        'start_with': [1, 2, 3],  # 모멘텀, 평균회귀, 가치투자
        'reasons': {
            1: '이해하기 쉬운 트렌드 추종 전략',
            2: '직관적인 평균회귀 개념',
            3: '검증된 장기 투자 철학'
        },
        'learning_path': [
            '1단계: 기본 전략 (1-3번) 이해 및 실습',
            '2단계: 성과 분석 방법 학습',
            '3단계: 중급 전략 (9, 10번) 도전',
            '4단계: 고급 전략 조합 시도'
        ],
        'cautions': [
            '처음에는 소액으로 시작',
            '감정적 매매 피하기',
            '꾸준한 기록과 분석',
            '과도한 레버리지 금지'
        ]
    }